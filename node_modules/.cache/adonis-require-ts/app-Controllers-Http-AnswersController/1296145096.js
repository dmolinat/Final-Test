"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Answer_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Answer"));
const Question_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Question"));
const QuestionsController_1 = __importDefault(require("./QuestionsController"));
class AnswersController {
    async createAnswer({ request, response }) {
        const { opcion, is_correct, state, question_id } = request.all();
        try {
            const answerObj = new Answer_1.default();
            answerObj.opcion = opcion;
            answerObj.is_correct = is_correct;
            answerObj.state = state;
            const state_question = await this.getValidarQuestion(question_id);
            if (state_question == 0) {
                return response.status(500).json({ "msg": "ERROR EN VALIDAR QUESTION" });
            }
            answerObj.question_id = question_id;
            const L_question = await Question_1.default.query().select('question', 'options').where('id', question_id);
            const options_question = L_question[0]['$attributes']['options'];
            const option = { opcion: answerObj['$attributes']['opcion'], iscorrect: answerObj['$attributes']['is_correct'] };
            options_question[options_question.length] = option;
            const question_aux = new QuestionsController_1.default();
            question_aux.updateQuestionNewAnswer(question_id, options_question);
            await answerObj.save();
            return response.status(200).json({ "state": true, "message": "Pregunta creada exitosamente" });
        }
        catch (e) {
            return response.status(500).json({ "state": false, "message": "Error al crear answer" });
        }
    }
    async createAnswerQuestion(question_id, options) {
        try {
            options.map((answer) => {
                const answer_new = new Answer_1.default();
                answer_new.opcion = answer['opcion'];
                answer_new.is_correct = answer['iscorrect'];
                answer_new.question_id = question_id;
                answer_new.state = true;
                answer_new.save();
            });
        }
        catch (e) {
        }
    }
    async getValidarQuestion(question_id) {
        const total = await Question_1.default.query().where({ "id": question_id }).count('*');
        return total.length;
    }
    async updateAnswer({ request, response }) {
        const id = request.param('id_opcion');
        const { opcion, iscorrect } = request.all();
        try {
            await Answer_1.default.query().where('id', id).update({
                opcion: opcion,
                is_correct: iscorrect
            });
            const L_answer = await Answer_1.default.query().select('question_id').where('id', id);
            const question_id = L_answer[0]['$attributes']['question_id'];
            const L_answerquestions = await Answer_1.default.query().select('opcion', 'is_correct').where('question_id', question_id);
            const op_aux = Array();
            for (const i in L_answerquestions) {
                op_aux[op_aux.length] = { opcion: L_answerquestions[i]['$attributes']['opcion'], iscorrect: L_answerquestions[i]['$attributes']['is_correct'] };
            }
            const question_aux = new QuestionsController_1.default();
            question_aux.updateQuestionNewAnswer(question_id, op_aux);
            return response.status(200).json({ "state": true, "message": "opcion Editada con exito" });
        }
        catch (e) {
            return response.status(500).json({ "state": false, "message": "Error al editar la opcion" });
        }
    }
    async getOptions({ request, response }) {
        const id = request.param('id_question');
        try {
            const L_answerquestions = await Answer_1.default.query().select('id', 'opcion').where('question_id', id);
            response.status(200).json({ "state": true, "message": "Listado de opciones", "options": L_answerquestions });
        }
        catch (e) {
            return response.status(500).json({ "state": false, "message": "Error al obtener listado de opciones" });
        }
    }
}
exports.default = AnswersController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQW5zd2Vyc0NvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBbnN3ZXJzQ29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLHFGQUF1QztBQUN2Qyx5RkFBMkM7QUFDM0MsZ0ZBQXdEO0FBRXhELE1BQXFCLGlCQUFpQjtJQUM3QixLQUFLLENBQUMsWUFBWSxDQUFDLEVBQUMsT0FBTyxFQUFDLFFBQVEsRUFBcUI7UUFDOUQsTUFBTSxFQUFDLE1BQU0sRUFBQyxVQUFVLEVBQUMsS0FBSyxFQUFDLFdBQVcsRUFBQyxHQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQTtRQUN6RCxJQUFHO1lBQ0QsTUFBTSxTQUFTLEdBQUcsSUFBSSxnQkFBTSxFQUFFLENBQUM7WUFDL0IsU0FBUyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFDMUIsU0FBUyxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7WUFDbEMsU0FBUyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUE7WUFDdkIsTUFBTSxjQUFjLEdBQUcsTUFBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDbEUsSUFBRyxjQUFjLElBQUUsQ0FBQyxFQUFDO2dCQUNuQixPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxFQUFFLDJCQUEyQixFQUFDLENBQUMsQ0FBQTthQUN2RTtZQUNELFNBQVMsQ0FBQyxXQUFXLEdBQUMsV0FBVyxDQUFBO1lBRWpDLE1BQU0sVUFBVSxHQUFHLE1BQU0sa0JBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUMsV0FBVyxDQUFDLENBQUE7WUFDL0YsTUFBTSxnQkFBZ0IsR0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsU0FBUyxDQUFD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QyxDQUFBO1lBQzVGLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUscUJBQXFCLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFDLENBQUMsQ0FBQTtTQUMzRztRQUFBLE9BQU0sQ0FBQyxFQUFDO1lBQ0wsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUMsU0FBUyxFQUFFLHNDQUFzQyxFQUFDLENBQUMsQ0FBQTtTQUN2RztJQUNILENBQUM7Q0FFRjtBQXZGRCxvQ0F1RkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xuaW1wb3J0IEFuc3dlciBmcm9tICdBcHAvTW9kZWxzL0Fuc3dlcic7XG5pbXBvcnQgUXVlc3Rpb24gZnJvbSAnQXBwL01vZGVscy9RdWVzdGlvbic7XG5pbXBvcnQgUXVlc3Rpb25zQ29udHJvbGxlciBmcm9tICcuL1F1ZXN0aW9uc0NvbnRyb2xsZXInO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBbnN3ZXJzQ29udHJvbGxlciB7XG4gIHB1YmxpYyBhc3luYyBjcmVhdGVBbnN3ZXIoe3JlcXVlc3QscmVzcG9uc2V9Okh0dHBDb250ZXh0Q29udHJhY3Qpe1xuICAgIGNvbnN0IHtvcGNpb24saXNfY29ycmVjdCxzdGF0ZSxxdWVzdGlvbl9pZH09cmVxdWVzdC5hbGwoKVxuICAgIHRyeXtcbiAgICAgIGNvbnN0IGFuc3dlck9iaiA9IG5ldyBBbnN3ZXIoKTtcbiAgICAgIGFuc3dlck9iai5vcGNpb24gPSBvcGNpb247XG4gICAgICBhbnN3ZXJPYmouaXNfY29ycmVjdCA9IGlzX2NvcnJlY3Q7XG4gICAgICBhbnN3ZXJPYmouc3RhdGUgPSBzdGF0ZVxuICAgICAgY29uc3Qgc3RhdGVfcXVlc3Rpb24gPSBhd2FpdCB0aGlzLmdldFZhbGlkYXJRdWVzdGlvbihxdWVzdGlvbl9pZCk7XG4gICAgICBpZihzdGF0ZV9xdWVzdGlvbj09MCl7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAwKS5qc29uKHtcIm1zZ1wiOiBcIkVSUk9SIEVOIFZBTElEQVIgUVVFU1RJT05cIn0pXG4gICAgICB9XG4gICAgICBhbnN3ZXJPYmoucXVlc3Rpb25faWQ9cXVlc3Rpb25faWRcblxuICAgICAgY29uc3QgTF9xdWVzdGlvbiA9IGF3YWl0IFF1ZXN0aW9uLnF1ZXJ5KCkuc2VsZWN0KCdxdWVzdGlvbicsICdvcHRpb25zJykud2hlcmUoJ2lkJyxxdWVzdGlvbl9pZClcbiAgICAgIGNvbnN0IG9wdGlvbnNfcXVlc3Rpb249TF9xdWVzdGlvblswXVsnJGF0dHJpYnV0ZXMnXVsnb3B0aW9ucyddXG4gICAgICBjb25zdCBvcHRpb24gPSB7b3BjaW9uOiBhbnN3ZXJPYmpbJyRhdHRyaWJ1dGVzJ11bJ29wY2lvbiddLCBpc2NvcnJlY3Q6IGFuc3dlck9ialsnJGF0dHJpYnV0ZXMnXVsnaXNfY29ycmVjdCddfVxuICAgICAgb3B0aW9uc19xdWVzdGlvbltvcHRpb25zX3F1ZXN0aW9uLmxlbmd0aF0gPSBvcHRpb25cbiAgICAgIGNvbnN0IHF1ZXN0aW9uX2F1eCA9IG5ldyBRdWVzdGlvbnNDb250cm9sbGVyKClcbiAgICAgIHF1ZXN0aW9uX2F1eC51cGRhdGVRdWVzdGlvbk5ld0Fuc3dlcihxdWVzdGlvbl9pZCxvcHRpb25zX3F1ZXN0aW9uKVxuXG4gICAgICBhd2FpdCBhbnN3ZXJPYmouc2F2ZSgpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24oe1wic3RhdGVcIjogdHJ1ZSxcIm1lc3NhZ2VcIjogXCJQcmVndW50YSBjcmVhZGEgZXhpdG9zYW1lbnRlXCJ9KVxuICAgIH1jYXRjaChlKXtcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAwKS5qc29uKHtcInN0YXRlXCI6IGZhbHNlLCBcIm1lc3NhZ2VcIjogXCJFcnJvciBhbCBjcmVhciBhbnN3ZXJcIn0pXG4gICAgfVxuXG4gIH1cblxuICBwdWJsaWMgYXN5bmMgY3JlYXRlQW5zd2VyUXVlc3Rpb24ocXVlc3Rpb25faWQ6IG51bWJlcixvcHRpb25zOiBKU09OW10pe1xuICAgIHRyeXtcbiAgICAgIG9wdGlvbnMubWFwKChhbnN3ZXIpPT57XG4gICAgICAgIGNvbnN0IGFuc3dlcl9uZXcgPSBuZXcgQW5zd2VyKClcbiAgICAgICAgYW5zd2VyX25ldy5vcGNpb24gPSBhbnN3ZXJbJ29wY2lvbiddXG4gICAgICAgIGFuc3dlcl9uZXcuaXNfY29ycmVjdCA9IGFuc3dlclsnaXNjb3JyZWN0J11cbiAgICAgICAgYW5zd2VyX25ldy5xdWVzdGlvbl9pZCA9IHF1ZXN0aW9uX2lkXG4gICAgICAgIGFuc3dlcl9uZXcuc3RhdGUgPSB0cnVlXG4gICAgICAgIGFuc3dlcl9uZXcuc2F2ZSgpXG4gICAgICB9KVxuICAgIH1jYXRjaChlKXtcbiAgICAgIC8vY29uc29sZS5sb2coYGUgLT4gJHtlfWApXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRWYWxpZGFyUXVlc3Rpb24ocXVlc3Rpb25faWQ6IG51bWJlcik6IFByb21pc2U8TnVtYmVyPntcbiAgICBjb25zdCB0b3RhbCA9IGF3YWl0IFF1ZXN0aW9uLnF1ZXJ5KCkud2hlcmUoe1wiaWRcIjogcXVlc3Rpb25faWR9KS5jb3VudCgnKicpXG4gICAgcmV0dXJuIHRvdGFsLmxlbmd0aDtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyB1cGRhdGVBbnN3ZXIoe3JlcXVlc3QscmVzcG9uc2V9OiBIdHRwQ29udGV4dENvbnRyYWN0KXtcbiAgICBjb25zdCBpZD1yZXF1ZXN0LnBhcmFtKCdpZF9vcGNpb24nKTtcbiAgICBjb25zdCB7b3BjaW9uLCBpc2NvcnJlY3R9ID0gcmVxdWVzdC5hbGwoKTtcbiAgICB0cnl7XG4gICAgICBhd2FpdCBBbnN3ZXIucXVlcnkoKS53aGVyZSgnaWQnLGlkKS51cGRhdGUoe1xuICAgICAgICBvcGNpb246IG9wY2lvbixcbiAgICAgICAgaXNfY29ycmVjdDogaXNjb3JyZWN0XG4gICAgfSk7XG4gICAgLy9BY3R1YWxpemFybG8gZW4gbGEgcHJlZ3VudGFcbiAgICAvL1NlbGVjY2lvbmFyIGxhcyByZXNwdWVzdGFzIGFzb2NpYWRhcyBhIGxhIHByZWd1bnRhXG4gICAgLy9FeHRyYWVyIGVsIHF1ZXN0aW9uX2lkIGFzb2NpYWRvIGEgbGEgcHJlZ3VudGFcbiAgICBjb25zdCBMX2Fuc3dlciA9IGF3YWl0IEFuc3dlci5xdWVyeSgpLnNlbGVjdCgncXVlc3Rpb25faWQnKS53aGVyZSgnaWQnLGlkKVxuICAgIGNvbnN0IHF1ZXN0aW9uX2lkPUxfYW5zd2VyWzBdWyckYXR0cmlidXRlcyddWydxdWVzdGlvbl9pZCddXG4gICAgLy9FeHRyYWVyIGxhIGxpc3RhIGRlIHByZWd1bnRhc1xuICAgIGNvbnN0IExfYW5zd2VycXVlc3Rpb25zID0gYXdhaXQgQW5zd2VyLnF1ZXJ5KCkuc2VsZWN0KCdvcGNpb24nLCdpc19jb3JyZWN0Jykud2hlcmUoJ3F1ZXN0aW9uX2lkJyxxdWVzdGlvbl9pZClcbiAgICBjb25zdCBvcF9hdXg9QXJyYXkoKTtcbiAgICBmb3IoY29uc3QgaSBpbiBMX2Fuc3dlcnF1ZXN0aW9ucyl7XG4gICAgICBvcF9hdXhbb3BfYXV4Lmxlbmd0aF0gPSB7b3BjaW9uOiBMX2Fuc3dlcnF1ZXN0aW9uc1tpXVsnJGF0dHJpYnV0ZXMnXVsnb3BjaW9uJ10sIGlzY29ycmVjdDpMX2Fuc3dlcnF1ZXN0aW9uc1tpXVsnJGF0dHJpYnV0ZXMnXVsnaXNfY29ycmVjdCddfVxuICAgIH1cblxuICAgIGNvbnN0IHF1ZXN0aW9uX2F1eCA9IG5ldyBRdWVzdGlvbnNDb250cm9sbGVyKClcbiAgICBxdWVzdGlvbl9hdXgudXBkYXRlUXVlc3Rpb25OZXdBbnN3ZXIocXVlc3Rpb25faWQsb3BfYXV4KVxuICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5qc29uKHtcInN0YXRlXCI6IHRydWUsIFwibWVzc2FnZVwiOiBcIm9wY2lvbiBFZGl0YWRhIGNvbiBleGl0b1wifSlcbiAgICB9Y2F0Y2goZSl7XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMCkuanNvbih7XCJzdGF0ZVwiOiBmYWxzZSxcIm1lc3NhZ2VcIjogXCJFcnJvciBhbCBlZGl0YXIgbGEgb3BjaW9uXCJ9KVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRPcHRpb25zKHtyZXF1ZXN0LHJlc3BvbnNlfTogSHR0cENvbnRleHRDb250cmFjdCl7XG4gICAgY29uc3QgaWQ9cmVxdWVzdC5wYXJhbSgnaWRfcXVlc3Rpb24nKTtcbiAgICB0cnl7XG4gICAgICBjb25zdCBMX2Fuc3dlcnF1ZXN0aW9ucyA9IGF3YWl0IEFuc3dlci5xdWVyeSgpLnNlbGVjdCgnaWQnLCdvcGNpb24nKS53aGVyZSgncXVlc3Rpb25faWQnLGlkKVxuICAgICAgcmVzcG9uc2Uuc3RhdHVzKDIwMCkuanNvbih7XCJzdGF0ZVwiOiB0cnVlLCBcIm1lc3NhZ2VcIjogXCJMaXN0YWRvIGRlIG9wY2lvbmVzXCIsIFwib3B0aW9uc1wiOiBMX2Fuc3dlcnF1ZXN0aW9uc30pXG4gICAgfWNhdGNoKGUpe1xuICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMCkuanNvbih7XCJzdGF0ZVwiOiBmYWxzZSxcIm1lc3NhZ2VcIjogXCJFcnJvciBhbCBvYnRlbmVyIGxpc3RhZG8gZGUgb3BjaW9uZXNcIn0pXG4gICAgfVxuICB9XG5cbn1cbiJdfQ==