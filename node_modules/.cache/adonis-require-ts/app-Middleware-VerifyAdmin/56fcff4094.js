"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const UsersController_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Controllers/Http/UsersController"));
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
class VerifyAdmin {
    async handle(ctx, next) {
        const authorizationHeader = ctx.request.header('authorization');
        if (authorizationHeader === undefined) {
            return ctx.response.status(401).send({
                mensaje: "Falta el token de autorización",
            });
        }
        try {
            const usersController = new UsersController_1.default();
            const { id } = await usersController.getPayload(authorizationHeader);
            const usuario = await User_1.default.find(id);
            if (!usuario) {
                return ctx.response.status(401).json({
                    msj: 'Token no válido'
                });
            }
            if (usuario.rol_id !== 1) {
                return ctx.response.status(401).json({ msj: 'No tiene permisos para acceder a esta ruta' });
            }
            await next();
        }
        catch (error) {
            console.log(`error -> ${error}`);
            ctx.response.status(400).json({ "msj": "Token no valido" });
        }
    }
}
exports.default = VerifyAdmin;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmVyaWZ5QWRtaW4uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJWZXJpZnlBZG1pbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLGlIQUFrRTtBQUNsRSxpRkFBa0M7QUFFbEMsTUFBcUIsV0FBVztJQUN2QixLQUFLLENBQUMsTUFBTSxDQUFDLEdBQXdCLEVBQUUsSUFBeUI7UUFDckUsTUFBTSxtQkFBbUIsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQTtRQUUvRCxJQUFHLG1CQUFtQixLQUFLLFNBQVMsRUFBQztZQUNuQyxPQUFPLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkMsT0FBTyxFQUFFLGdDQUFnQzthQUFFLENBQUMsQ0FBQTtTQUFDO1FBRWpELElBQUc7WUFDRCxNQUFNLGVBQWUsR0FBRyxJQUFJLHlCQUFlLEVBQUUsQ0FBQTtZQUM3QyxNQUFNLEVBQUMsRUFBRSxFQUFDLEdBQUcsTUFBTSxlQUFlLENBQUMsVUFBVSxDQUFDLG1CQUFtQixDQUFDLENBQUE7WUFDbEUsTUFBTSxPQUFPLEdBQUcsTUFBTSxjQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1lBRW5DLElBQUcsQ0FBQyxPQUFPLEVBQUM7Z0JBQ1YsT0FBTyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQ25DLEdBQUcsRUFBRSxpQkFBaUI7aUJBQUMsQ0FBQyxDQUFBO2FBQUM7WUFFN0IsSUFBRyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBQztnQkFDdEIsT0FBTyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxHQUFHLEVBQUUsNENBQTRDLEVBQUMsQ0FBQyxDQUFBO2FBQzFGO1lBQ0QsTUFBTSxJQUFJLEVBQUUsQ0FBQTtTQUNiO1FBQUEsT0FBTSxLQUFLLEVBQUM7WUFDWCxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksS0FBSyxFQUFFLENBQUMsQ0FBQztZQUNqQyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsaUJBQWlCLEVBQUMsQ0FBQyxDQUFBO1NBQzFEO0lBQ0gsQ0FBQztDQUNGO0FBMUJELDhCQTBCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSHR0cENvbnRleHRDb250cmFjdCB9IGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvSHR0cENvbnRleHQnXG5pbXBvcnQgVXNlcnNDb250cm9sbGVyIGZyb20gJ0FwcC9Db250cm9sbGVycy9IdHRwL1VzZXJzQ29udHJvbGxlcidcbmltcG9ydCBVc2VyIGZyb20gJ0FwcC9Nb2RlbHMvVXNlcidcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmVyaWZ5QWRtaW4ge1xuICBwdWJsaWMgYXN5bmMgaGFuZGxlKGN0eDogSHR0cENvbnRleHRDb250cmFjdCwgbmV4dDogKCkgPT4gUHJvbWlzZTx2b2lkPikge1xuICAgIGNvbnN0IGF1dGhvcml6YXRpb25IZWFkZXIgPSBjdHgucmVxdWVzdC5oZWFkZXIoJ2F1dGhvcml6YXRpb24nKVxuXG4gICAgaWYoYXV0aG9yaXphdGlvbkhlYWRlciA9PT0gdW5kZWZpbmVkKXtcbiAgICAgIHJldHVybiBjdHgucmVzcG9uc2Uuc3RhdHVzKDQwMSkuc2VuZCh7XG4gICAgICAgIG1lbnNhamU6IFwiRmFsdGEgZWwgdG9rZW4gZGUgYXV0b3JpemFjacOzblwiLH0pfVxuXG4gICAgdHJ5e1xuICAgICAgY29uc3QgdXNlcnNDb250cm9sbGVyID0gbmV3IFVzZXJzQ29udHJvbGxlcigpXG4gICAgICBjb25zdCB7aWR9ID0gYXdhaXQgdXNlcnNDb250cm9sbGVyLmdldFBheWxvYWQoYXV0aG9yaXphdGlvbkhlYWRlcilcbiAgICAgIGNvbnN0IHVzdWFyaW8gPSBhd2FpdCBVc2VyLmZpbmQoaWQpXG5cbiAgICAgIGlmKCF1c3VhcmlvKXtcbiAgICAgICAgcmV0dXJuIGN0eC5yZXNwb25zZS5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtc2o6ICdUb2tlbiBubyB2w6FsaWRvJ30pfVxuXG4gICAgICBpZih1c3VhcmlvLnJvbF9pZCAhPT0gMSl7ICAgICAgLy9pZF9wcm9maWxlID0gMSwgaXQncyBhZG1pbi5cbiAgICAgICAgcmV0dXJuIGN0eC5yZXNwb25zZS5zdGF0dXMoNDAxKS5qc29uKHttc2o6ICdObyB0aWVuZSBwZXJtaXNvcyBwYXJhIGFjY2VkZXIgYSBlc3RhIHJ1dGEnfSlcbiAgICAgIH1cbiAgICAgIGF3YWl0IG5leHQoKVxuICAgIH1jYXRjaChlcnJvcil7XG4gICAgICBjb25zb2xlLmxvZyhgZXJyb3IgLT4gJHtlcnJvcn1gKTtcbiAgICAgIGN0eC5yZXNwb25zZS5zdGF0dXMoNDAwKS5qc29uKHtcIm1zalwiOiBcIlRva2VuIG5vIHZhbGlkb1wifSlcbiAgICB9XG4gIH1cbn1cbiJdfQ==