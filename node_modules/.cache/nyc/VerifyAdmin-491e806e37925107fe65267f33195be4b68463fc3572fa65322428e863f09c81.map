{"version":3,"file":"VerifyAdmin.js","sourceRoot":"","sources":["VerifyAdmin.ts"],"names":[],"mappings":";;;;;AACA,iHAAkE;AAClE,iFAAkC;AAElC,MAAqB,WAAW;IACvB,KAAK,CAAC,MAAM,CAAC,GAAwB,EAAE,IAAyB;QACrE,MAAM,mBAAmB,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,eAAe,CAAC,CAAA;QAE/D,IAAG,mBAAmB,KAAK,SAAS,EAAC;YACnC,OAAO,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBACnC,OAAO,EAAE,gCAAgC;aAAE,CAAC,CAAA;SAAC;QAEjD,IAAG;YACD,MAAM,eAAe,GAAG,IAAI,yBAAe,EAAE,CAAA;YAC7C,MAAM,EAAC,EAAE,EAAC,GAAG,MAAM,eAAe,CAAC,UAAU,CAAC,mBAAmB,CAAC,CAAA;YAClE,MAAM,OAAO,GAAG,MAAM,cAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;YAEnC,IAAG,CAAC,OAAO,EAAC;gBACV,OAAO,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;oBACnC,GAAG,EAAE,iBAAiB;iBAAC,CAAC,CAAA;aAAC;YAE7B,IAAG,OAAO,CAAC,MAAM,KAAK,CAAC,EAAC;gBACtB,OAAO,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAC,GAAG,EAAE,4CAA4C,EAAC,CAAC,CAAA;aAC1F;YACD,MAAM,IAAI,EAAE,CAAA;SACb;QAAA,OAAM,KAAK,EAAC;YACX,OAAO,CAAC,GAAG,CAAC,YAAY,KAAK,EAAE,CAAC,CAAC;YACjC,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,iBAAiB,EAAC,CAAC,CAAA;SAC1D;IACH,CAAC;CACF;AA1BD,8BA0BC","sourcesContent":["import type { HttpContextContract } from '@ioc:Adonis/Core/HttpContext'\nimport UsersController from 'App/Controllers/Http/UsersController'\nimport User from 'App/Models/User'\n\nexport default class VerifyAdmin {\n  public async handle(ctx: HttpContextContract, next: () => Promise<void>) {\n    const authorizationHeader = ctx.request.header('authorization')\n\n    if(authorizationHeader === undefined){\n      return ctx.response.status(401).send({\n        mensaje: \"Falta el token de autorización\",})}\n\n    try{\n      const usersController = new UsersController()\n      const {id} = await usersController.getPayload(authorizationHeader)\n      const usuario = await User.find(id)\n\n      if(!usuario){\n        return ctx.response.status(401).json({\n          msj: 'Token no válido'})}\n\n      if(usuario.rol_id !== 1){      //id_profile = 1, it's admin.\n        return ctx.response.status(401).json({msj: 'No tiene permisos para acceder a esta ruta'})\n      }\n      await next()\n    }catch(error){\n      console.log(`error -> ${error}`);\n      ctx.response.status(400).json({\"msj\": \"Token no valido\"})\n    }\n  }\n}\n"]}